
#!/bin/bash

sudo netstat -tunapl | less
#echo "$netstat"

#* you might want to enter PID or name of another process as an argument
param=
while [ -z ${param}]
do
echo "input PID or Program name: "
read param
if [ -z ${param} ]
then
        echo "no PID or Program"
else
        break
fi
done

#*  you might want to see more results
read -p "Enter tail count: " ctail
if [ -z ${ctail} ]
then
        ctail=5
fi

#netstat2=`sudo netstat -tunapl | awk ''/$param/' {print $5}' | cut -d: -f1 | sort | uniq -c | tail -n$ctail | sort | grep -oP '(\d+\.){3}\d+'`


#* for adding count of connections per organization to the final output
# sort | uniq -c
# как сделать комманды + все, что через слеш не нашел(
# 2 проблема, что комманда вызывается 2 раз, то есть данные которые видит пользователи и то, что парситься 2 разные вещи(
netstat=`sudo netstat -tunapl | awk ''/$param/' {print $5}' | cut -d: -f1 | sort | uniq -c | tail -n$ctail | sort | grep -oP '(\d+\.){3}\d+' \
        | while read IP ; do whois $IP | awk -F':' '/^Organization/ {print $2}' ; done | sort | uniq -c`

ss2=`sudo ss -t -p | awk ''/$param/' {print $5}' | cut -d: -f1 | sort | uniq -c | tail -n$ctail | sort | grep -oP '(\d+\.){3}\d+' \
        | while read IP ; do whois $IP | awk -F':' '/^Organization/ {print $2}' ; done | sort | uniq -c`
echo "ss"
echo $ss2
echo "netstat"
echo $netstat
